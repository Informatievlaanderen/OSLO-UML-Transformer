{"version":3,"file":"ActorAbstractMediaTyped.js","sourceRoot":"","sources":["ActorAbstractMediaTyped.ts"],"names":[],"mappings":";;;AACA,yCAAuC;AAGvC;;;;;;;;;;GAUG;AACH,MAAsB,uBACpB,SAAQ,YAA0G;IAClH,YAAmB,IAAsC;QACvD,KAAK,CAAC,IAAI,CAAC,CAAC;IACd,CAAC;IAEM,KAAK,CAAC,GAAG,CAAC,MAAqC;QACpD,IAAI,QAAQ,IAAI,MAAM,EAAE;YACtB,MAAM,WAAW,GAAwC,MAAM,CAAC;YAChE,OAAO,EAAE,MAAM,EAAE,MAAM,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC,MAAM,EAAE,WAAW,CAAC,eAAe,EAAE,MAAM,CAAC,OAAO,CAAC,EAAE,CAAC;SAC1G;QACD,IAAI,YAAY,IAAI,MAAM,EAAE;YAC1B,OAAO,EAAE,UAAU,EAAE,MAAM,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,OAAO,CAAC,EAAE,CAAC;SACjE;QACD,IAAI,kBAAkB,IAAI,MAAM,EAAE;YAChC,OAAO,EAAE,gBAAgB,EAAE,MAAM,IAAI,CAAC,mBAAmB,CAAC,MAAM,CAAC,OAAO,CAAC,EAAE,CAAC;SAC7E;QACD,MAAM,IAAI,KAAK,CAAC,6EAA6E,CAAC,CAAC;IACjG,CAAC;IAEM,KAAK,CAAC,IAAI,CAAC,MAAqC;QACrD,IAAI,QAAQ,IAAI,MAAM,EAAE;YACtB,MAAM,WAAW,GAAwC,MAAM,CAAC;YAChE,OAAO,EAAE,MAAM,EAAE,MAAM,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,MAAM,EAAE,WAAW,CAAC,eAAe,EAAE,MAAM,CAAC,OAAO,CAAC,EAAE,CAAC;SAC3G;QACD,IAAI,YAAY,IAAI,MAAM,EAAE;YAC1B,OAAO,EAAE,UAAU,EAAE,MAAM,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,OAAO,CAAC,EAAE,CAAC;SACjE;QACD,IAAI,kBAAkB,IAAI,MAAM,EAAE;YAChC,OAAO,EAAE,gBAAgB,EAAE,MAAM,IAAI,CAAC,oBAAoB,CAAC,MAAM,CAAC,OAAO,CAAC,EAAE,CAAC;SAC9E;QACD,MAAM,IAAI,KAAK,CAAC,6EAA6E,CAAC,CAAC;IACjG,CAAC;CAsDF;AAtFD,0DAsFC","sourcesContent":["import type { IAction, IActorArgs, IActorOutput, IActorTest, Mediate } from '@comunica/core';\nimport { Actor } from '@comunica/core';\nimport type { IActionContext } from '@comunica/types';\n\n/**\n * An abstract actor that handles media-typed actions.\n *\n * It splits up a action between a 'handle' and a 'mediaTypes' action.\n * A 'mediaTypes' action is used to retrieve the available media types from this actor.\n * A 'handle' action is abstract, and can be implemented to do anything,\n * such as parsing, serializing, etc.\n * @see IActionAbstractMediaTyped\n *\n * @see ActorAbstractMediaTypedFixed\n */\nexport abstract class ActorAbstractMediaTyped<HI, HT, HO>\n  extends Actor<IActionAbstractMediaTyped<HI>, IActorTestAbstractMediaTyped<HT>, IActorOutputAbstractMediaTyped<HO>> {\n  public constructor(args: IActorArgsMediaTyped<HI, HT, HO>) {\n    super(args);\n  }\n\n  public async run(action: IActionAbstractMediaTyped<HI>): Promise<IActorOutputAbstractMediaTyped<HO>> {\n    if ('handle' in action) {\n      const typedAction: IActionAbstractMediaTypedHandle<HI> = action;\n      return { handle: await this.runHandle(typedAction.handle, typedAction.handleMediaType, action.context) };\n    }\n    if ('mediaTypes' in action) {\n      return { mediaTypes: await this.getMediaTypes(action.context) };\n    }\n    if ('mediaTypeFormats' in action) {\n      return { mediaTypeFormats: await this.getMediaTypeFormats(action.context) };\n    }\n    throw new Error('Either a handle, mediaTypes or mediaTypeFormats action needs to be provided');\n  }\n\n  public async test(action: IActionAbstractMediaTyped<HI>): Promise<IActorTestAbstractMediaTyped<HT>> {\n    if ('handle' in action) {\n      const typedAction: IActionAbstractMediaTypedHandle<HI> = action;\n      return { handle: await this.testHandle(typedAction.handle, typedAction.handleMediaType, action.context) };\n    }\n    if ('mediaTypes' in action) {\n      return { mediaTypes: await this.testMediaType(action.context) };\n    }\n    if ('mediaTypeFormats' in action) {\n      return { mediaTypeFormats: await this.testMediaTypeFormats(action.context) };\n    }\n    throw new Error('Either a handle, mediaTypes or mediaTypeFormats action needs to be provided');\n  }\n\n  /**\n   * Check if this actor can run the given handle action,\n   * without actually running it.\n   *\n   * @param {HI} action The handle action to test.\n   * @param {string} mediaType The media type to test.\n   * @param {ActionContext} context An optional context.\n   * @return {Promise<T>} A promise that resolves to the handle test result.\n   */\n  public abstract testHandle(action: HI, mediaType: string | undefined, context: IActionContext): Promise<HT>;\n\n  /**\n   * Run the given handle action on this actor.\n   *\n   * @param {HI} action The handle action to run.\n   * @param {string} mediaType The media type to run with.\n   * @param {ActionContext} context An optional context.\n   * @return {Promise<T>} A promise that resolves to the handle run result.\n   */\n  public abstract runHandle(action: HI, mediaType: string | undefined, context: IActionContext): Promise<HO>;\n\n  /**\n   * Check if this actor can emit its media types.\n   *\n   * @param {ActionContext} context An optional context.\n   * @return {Promise<boolean>} A promise that resolves to the media type run result.\n   */\n  public abstract testMediaType(context: IActionContext): Promise<boolean>;\n\n  /**\n   * Get the media type of this given actor.\n   *\n   * @param {ActionContext} context An optional context.\n   * @return {Promise<{[id: string]: number}>} A promise that resolves to the media types.\n   */\n  public abstract getMediaTypes(context: IActionContext): Promise<Record<string, number>>;\n\n  /**\n   * Check if this actor can emit its media type formats.\n   *\n   * @param {ActionContext} context An optional context.\n   * @return {Promise<boolean>} A promise that resolves to the media type run result.\n   */\n  public abstract testMediaTypeFormats(context: IActionContext): Promise<boolean>;\n\n  /**\n   * Get the media type formats of this given actor.\n   *\n   * @param {ActionContext} context An optional context.\n   * @return {Promise<{[id: string]: string}>} A promise that resolves to the media types.\n   */\n  public abstract getMediaTypeFormats(context: IActionContext): Promise<Record<string, string>>;\n}\n\nexport interface IActorArgsMediaTyped<HI, HT, HO> extends IActorArgs<IActionAbstractMediaTyped<HI>,\nIActorTestAbstractMediaTyped<HT>, IActorOutputAbstractMediaTyped<HO>> {}\n\nexport type IActionAbstractMediaTyped<HI> = IActionAbstractMediaTypedHandle<HI> | IActionAbstractMediaTypedMediaTypes\n| IActionAbstractMediaTypedMediaTypeFormats;\nexport interface IActionAbstractMediaTypedHandle<HI> extends IAction {\n  /**\n   * The handle action input.\n   */\n  handle: HI;\n  /**\n   * The handle media type that should be used when 'handle' is truthy.\n   */\n  handleMediaType?: string;\n}\n\nexport interface IActionAbstractMediaTypedMediaTypes extends IAction {\n  /**\n   * True if media types should be retrieved.\n   */\n  mediaTypes: boolean;\n}\n\nexport interface IActionAbstractMediaTypedMediaTypeFormats extends IAction {\n  /**\n   * True if media type formats should be retrieved.\n   */\n  mediaTypeFormats: boolean;\n}\n\n/**\n * Either 'handle', or 'mediaTypes' or 'mediaTypeFormats' must be truthy.\n * Groups may not be truthy at the same time.\n */\nexport type IActorTestAbstractMediaTyped<HT> = IActorTestAbstractMediaTypedHandle<HT>\n| IActorTestAbstractMediaTypedMediaTypes | IActorTestAbstractMediaTypedMediaTypeFormats;\nexport interface IActorTestAbstractMediaTypedHandle<HT> extends IActorTest {\n  /**\n   * The handle test output.\n   */\n  handle: HT;\n}\nexport interface IActorTestAbstractMediaTypedMediaTypes extends IActorTest {\n  /**\n   * True if media types can be retrieved.\n   */\n  mediaTypes: boolean;\n}\nexport interface IActorTestAbstractMediaTypedMediaTypeFormats extends IActorTest {\n  /**\n   * True if media type formats can be retrieved.\n   */\n  mediaTypeFormats?: boolean;\n}\n\n/**\n * Either 'handle', or 'mediaTypes' or 'mediaTypeFormats' must be truthy.\n * Groups may not be truthy at the same time.\n */\nexport type IActorOutputAbstractMediaTyped<HO> = IActorOutputAbstractMediaTypedHandle<HO>\n| IActorOutputAbstractMediaTypedMediaTypes | IActorOutputAbstractMediaTypedMediaTypeFormats;\nexport interface IActorOutputAbstractMediaTypedHandle<HO> extends IActorOutput {\n  /**\n   * The handle action output.\n   */\n  handle: HO;\n}\nexport interface IActorOutputAbstractMediaTypedMediaTypes extends IActorOutput {\n  /**\n   * An object containing media types as keys,\n   * and preferences as values, with values ranging from 0 to 1.\n   */\n  mediaTypes: Record<string, number>;\n}\nexport interface IActorOutputAbstractMediaTypedMediaTypeFormats extends IActorOutput {\n  /**\n   * An object containing media types as keys,\n   * and format IRIs as values.\n   */\n  mediaTypeFormats: Record<string, string>;\n}\n\nexport type MediateMediaTypes = Mediate<\nIActionAbstractMediaTypedMediaTypes, IActorOutputAbstractMediaTypedMediaTypes, IActorTestAbstractMediaTypedMediaTypes>;\n\nexport type MediateMediaTyped<I extends IAction, T extends IActorTest, O extends IActorOutput> = Mediate<\nIActionAbstractMediaTypedHandle<I>,\nIActorOutputAbstractMediaTypedHandle<O>,\nIActorTestAbstractMediaTypedHandle<T>\n>;\n"]}