{"version":3,"file":"DocumentLoaderMediated.js","sourceRoot":"","sources":["DocumentLoaderMediated.ts"],"names":[],"mappings":";;;AACA,iDAA+C;AAE/C,iEAA4D;AAC5D,oHAAoH;AACpH,oDAAqD;AAErD;;GAEG;AACH,MAAa,sBAAuB,SAAQ,2CAAmB;IAK7D,YAAmB,YAA0B,EAC3C,OAAuB;QACvB,KAAK,CAAC,sBAAsB,CAAC,aAAa,CAAC,YAAY,EAAE,OAAO,CAAC,CAAC,CAAC;QACnE,IAAI,CAAC,YAAY,GAAG,YAAY,CAAC;QACjC,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC;IACzB,CAAC;IAES,MAAM,CAAC,aAAa,CAAC,YAA0B,EAAE,OAAuB;QAEhF,OAAO,KAAK,EAAC,GAAW,EAAE,IAAiB,EAAE,EAAE;YAC7C,MAAM,QAAQ,GAAG,MAAM,YAAY,CAAC,OAAO,CAAC,EAAE,KAAK,EAAE,GAAG,EAAE,IAAI,EAAE,OAAO,EAAE,CAAC,CAAC;YAC3E,QAAQ,CAAC,IAAI,GAAG,KAAK,IAAG,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,eAAe,CAAC,oBAAS,CAAC,cAAc,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YACtG,OAAO,QAAQ,CAAC;QAClB,CAAC,CAAC;IACJ,CAAC;CACF;AApBD,wDAoBC","sourcesContent":["import type { MediatorHttp } from '@comunica/bus-http';\nimport { ActorHttp } from '@comunica/bus-http';\nimport type { IActionContext } from '@comunica/types';\nimport { FetchDocumentLoader } from 'jsonld-context-parser';\n// Use require instead of import for default exports, to be compatible with variants of esModuleInterop in tsconfig.\nimport stringifyStream = require('stream-to-string');\n\n/**\n * A JSON-LD document loader that fetches over an HTTP bus using a given mediator.\n */\nexport class DocumentLoaderMediated extends FetchDocumentLoader {\n  private readonly mediatorHttp: MediatorHttp;\n\n  private readonly context: IActionContext;\n\n  public constructor(mediatorHttp: MediatorHttp,\n    context: IActionContext) {\n    super(DocumentLoaderMediated.createFetcher(mediatorHttp, context));\n    this.mediatorHttp = mediatorHttp;\n    this.context = context;\n  }\n\n  protected static createFetcher(mediatorHttp: MediatorHttp, context: IActionContext):\n  (input: RequestInfo, init: RequestInit) => Promise<Response> {\n    return async(url: string, init: RequestInit) => {\n      const response = await mediatorHttp.mediate({ input: url, init, context });\n      response.json = async() => JSON.parse(await stringifyStream(ActorHttp.toNodeReadable(response.body)));\n      return response;\n    };\n  }\n}\n"]}